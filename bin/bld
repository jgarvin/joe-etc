#!/usr/bin/env zsh

# TODO: Logic for ssh'ing?
# Yeah, look for being a subfolder of ~/rmt
# Then just execute self on remote host

set -e

setopt chasedots

bld_list_dir=$(dirname $(find_up -name bld-list))

cd $bld_list_dir

echo "Building from: $PWD"
for i in $(cat bld-list | grep -v '^#'); do
    echo "Building: $i"
    if [ -d "$i" ]; then
        pushd "$i"
        make "$@"
        popd
    else
        pushd $(dirname "$i")
        make $(basename "$i") "$@"
        popd
    fi
done

if which gtags &> /dev/null; then
    echo "Regenerating tags"
    if ! global -u &> /dev/null; then
        gtags
    fi &
fi
