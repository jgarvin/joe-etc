#!/usr/bin/env zsh

exchange="$1"

if [ "$1" = "" ]; then
		echo >&2 "Must specify exchange."
		exit 1
fi

if [ "$2" = "" ]; then
		year=$(date +%Y)
		month=$(date +%m)
		day=$(date +%d)
else
		year=$(echo "$2" | cut -d'-' -f 1)
		month=$(echo "$2" | cut -d'-' -f 2)
		day=$(echo "$2" | cut -d'-' -f 3)
fi

archive_path="$CNAME/ARCHIVE/TIER1/$PNAME/RAW/$exchange/primary/$year/$month/$day"

source_path="/$archive_path"
target_path="$HOME/local_archive/$archive_path"

if [ ! -d "$source_path" ]; then
		echo >&2 "Source directory does not exist: $source_path"
		exit 1
fi

echo "Copying from $source_path to $target_path..."

if [ "$DRY_RUN" = "" ]; then
		mkdir -p "$target_path"
		cp "$source_path"/* "$target_path"
fi
